import{L as c,M as n,N as u,Z as s}from"./nI3R1_-z.js";import{s as h}from"./C2pcbY5Z.js";import{q as i}from"./DdzLn5g6.js";const p=c();p.use(n);const l="https://strapi-potr.onrender.com",_=u({id:"musicStore",state:()=>({search:{query:"",results:[],filters:[],loading:!1,error:null},interface:null,filters:[],active_filters:[],filter_key:0,filter_option_key:0,albums:[],artists:[],tracks:[],player:{track:null,playing:!1,paused:!1,selecting:!1,track_time:"",elapsed:"",duration:"",volume:.75,mute:!1},comp_key:0}),actions:{async init_music(){await this.fetch_albums(),await this.fetch_artists(),await this.fetch_tracks(),await this.fetch_interface()},async fetch_albums(){this.albums=await fetch(`${l}/api/albums?${i.stringify({populate:["title","release_date","artwork","music_artists","tracks","ratings","ratings.one_star","ratings.two_stars","ratings.three_stars","ratings.four_stars","ratings.five_stars"]},{arrayFormat:"comma"})}`).then(t=>t.json()).catch(t=>console.error(t))},async fetch_artists(){this.artists=await fetch(`${l}/api/music-artists?${i.stringify({populate:["name","bio","profile_picture","pictures","socials","socials.platform","socials.link","albums","albums.title","albums.artwork","albums.release_date","albums.music_artists","albums.ratings","tracks"]},{arrayFormat:"comma"})}`).then(t=>t.json()).catch(t=>console.error(t))},async fetch_tracks(){console.log("fetching tracks..."),this.tracks=await fetch(`${l}/api/tracks?${i.stringify({populate:["title","audio_file","album","albums","single_cover","music_artists","genres","ratings","ratings.one_star","ratings.two_stars","ratings.three_stars","ratings.four_stars","ratings.five_stars"]},{arrayFormat:"comma"})}`).then(t=>t.json()).catch(t=>console.error(t)),s(()=>{this.search.results=this.tracks.data})},async fetch_interface(){this.interface=await fetch(`${l}/api/music-interface?${i.stringify({populate:["genres","artists"]})}`).then(t=>t.json()).catch(t=>console.error(t))},reset(){},scrub(t){const e=document.getElementById("audio_player"),a=document.getElementById("timeline"),r=window.getComputedStyle(a).width,o=t.offsetX/parseInt(r)*e.duration;e.currentTime=o},reset_scrubber(){const t=document.getElementById("audio_player");s(()=>{t.currentTime=0,this.player.track_time=0,this.player.elapsed="00:00",this.player.duration=this.format_time(t.duration)})},scrub_int(){h(()=>{this.player.track_time=audio_player.currentTime/audio_player.duration*100,this.player.duration=this.format_time(audio_player.duration),this.player.elapsed=this.format_time(audio_player.currentTime),this.player.track_time===100&&clearInterval(scrub_int)},1e3)},update_tracktime(){const t=document.getElementById("audio_player");s(()=>{this.player.playing?this.scrub_int():(this.player.track_time=0,this.player.elapsed="00:00",this.player.duration=this.format_time(t.duration))})},format_time(t){let e=parseInt(t),a=parseInt(e/60);e-=a*60;const r=parseInt(a/60);return a-=r*60,r===0?`${a}:${String(e%60).padStart(2,0)}`:`${String(r).padStart(2,0)}:${a}:${String(e%60).padStart(2,0)}`},play(t,e){this.player.track?this.player.track.id===t.id?this.fire_play():(this.player.track=!1,this.player.playing=!1,this.player.paused=!0,s(()=>{this.player.track=t,s(()=>{this.fire_play()})})):(this.player.track=t,s(()=>{this.fire_play()}))},pause(){document.getElementById("audio_player").pause(),this.player.playing=!1,this.player.paused=!0},select_previous(){const t=this.player.track,e=this.search.results.indexOf(t)-1;this.player.track=!1,s(()=>{this.player.track=this.search.results[e]?this.search.results[e]:t,document.getElementById("audio_player"),s(()=>{this.fire_play()})})},select_next(){const t=this.player.track,e=this.search.results.indexOf(t)+1;this.player.track=!1,s(()=>{this.player.track=this.search.results[e]?this.search.results[e]:t;const a=document.getElementById("audio_player");a.volume=this.player.volume,s(()=>{this.fire_play()})})},mute_track(){const t=document.getElementById("audio_player");this.player.mute=!this.player.mute,t.muted=!t.muted},adjust_volume(t){const e=document.getElementById("audio_player"),a=document.getElementById("volume_adjuster"),r=t.offsetX/a.offsetWidth;e.volume=r,this.player.volume=r},doSearch(){!this.search.query.length||this.search.query.length<2?this.clearSearch():this.search.results=this.tracks.data.filter(t=>t.title.toLowerCase().includes(this.search.query.toLowerCase()))},clearSearch(){this.search.results=this.tracks.data},doFilter(t){console.log("filtering by",t),this.search.results=[],this.tracks.data.forEach(e=>{e.genres.some(a=>a.label.toLowerCase()===t.label.toLowerCase())&&(this.search.results.push(e),this.search.filters.push(t),t.active=!0),e.music_artists.some(a=>a.name.toLowerCase()===t.label.toLowerCase())&&(this.search.results.push(e),this.search.filters.push(t),t.active=!0)})},clearFilters(){console.log("clearing filters"),this.search.results=this.tracks.data,this.search.filters.forEach(t=>{t.active=!1}),s(()=>{this.search.filters=[]})},fire_play(){const t=document.getElementById("audio_player");s(()=>{t.volume=this.player.volume,t.play(),this.player.playing=!0,this.update_tracktime()})}},getters:{},persist:{enabled:!0}});export{_ as u};
